<!DOCTYPE html>
<html lang="en-CA">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="author" content="Devon Sawatsky Burnham">

    <title>Lose at Hangman</title>

    <style>
        #playarea {
            display: flex;

        }

        #playarea button {
            font-size: 20px;
            background-color: aliceblue;
            /* color: white; */
            border: 2px solid cornflowerblue;
            border-radius: 8px;
            padding: 2px;
            margin: 2px;
            min-width: 1rem;
        }

        #playarea button:hover {
            background-color: lightblue;
        }

        #playarea button:active {
            background-color: mediumslateblue;
        }
    </style>
</head>

<body>
    <div class="content">
        <h1>Lose at Hangman</h1>
        <noscript>Please enable JavaScript on this page; nothing works without it, and I promise not to be evil :)<br>
            You can view the full script with inspect element, it's all inline.</noscript>
        <main id="gameboard"></main>
    </div>
</body>

</html>

<script defer>
    let currentLetter = " ";
    let pattern = [];
    let guesses = [];
    reset();

    function updateValue() {
        const element = document.getElementById("playarea");
        const numLettersInput = document.querySelector('input');
        pattern = [];

        while (element.hasChildNodes()) {
            element.removeChild(element.lastChild);
        }

        if (isNaN(numLettersInput.valueAsNumber) || numLettersInput.valueAsNumber < 1) {
            let p = document.createElement("p");
            p.innerText = "please only submit positive numbers. my code is fragile and so am i";
            element.appendChild(p);
            return;
        }

        for (let i = 0; i < numLettersInput.valueAsNumber; i++) {
            let button = document.createElement("button");
            button.id = "letterbox" + i;
            button.innerText = " ";
            button.setAttribute("onclick", "setButton(" + i + ")");
            // button.onclick = "setButton(" + i + ")";
            element.appendChild(button);
            pattern.push(".");
        }

        let main = document.getElementById("gameboard");
        main.removeChild(document.getElementById("letterQuery"));
        main.removeChild(document.getElementById("num_letters"));
        main.removeChild(document.getElementById("submit"));

        let guessContainer = document.createElement("p");
        let currentGuess = document.createElement("span");
        currentGuess.id = "lastGuess";
        currentGuess.innerText = "No guesses yet";
        let guessTracker = document.createElement("span");
        guessTracker.id = "guessTracker";
        // guessTracker.innerText = "No guesses yet";
        guessContainer.appendChild(currentGuess);
        guessContainer.appendChild(guessTracker);

        let guessButton = document.createElement("button");
        guessButton.type = "button";
        guessButton.id = "guessButton";
        guessButton.setAttribute("onclick", "getNewGuess()");
        guessButton.innerText = "Give me a guess!";
        let resetButton = document.createElement("button");
        resetButton.type = "button";
        resetButton.id = "resetButton";
        resetButton.setAttribute("onclick", "reset()");
        resetButton.innerText = "Reset to defaults";

        main.appendChild(guessContainer);
        main.appendChild(guessButton);
        main.appendChild(resetButton);

        console.log("buttons created");
    }
    function setButton(i) {
        const button = document.getElementById("letterbox" + i);
        if (button.innerText === " ") {
            button.innerText = currentLetter;
            if (currentLetter !== " ") {
                pattern[i] = currentLetter;
            }
        } else if (button.innerText === currentLetter) {
            button.innerText = " ";
            pattern[i] = ".";
        }
    }
    function getNewGuess() {
        let guessContainer = document.getElementById("lastGuess");
        console.log(pattern);
        document.getElementById("guessTracker").innerText =
            ", past guesses: " + guesses.join(", ") +
            ". The server has " + (6 - guesses.filter((guess) => pattern.indexOf(guess) < 0).length) +
            " guesses remaining";
        fetch("hangman/api?pattern=" + pattern.join("") + "&guesses=" + guesses.join(""))
            .then((response) => response.text())
            .then((text) => {
                if (text.length === 1) {
                    currentLetter = text;
                    guesses.push(currentLetter);
                    console.log(currentLetter);
                    guessContainer.innerText = "Server guessed: " + currentLetter;
                } else {
                    guessContainer.innerText = text;
                    document.getElementById("guessButton").remove();
                    currentLetter = " ";
                }
            }
            );
    }
    function reset() {
        let board = document.getElementById("gameboard");

        let letterQuery = document.createElement("label");
        letterQuery.id = "letterQuery";
        letterQuery.innerText = "How many letters is your word?";
        let input = document.createElement("input");
        input.type = "number";
        input.id = "num_letters";
        let submitButton = document.createElement("button");
        submitButton.type = "button";
        submitButton.id = "submit";
        submitButton.setAttribute("onclick", "updateValue()");
        submitButton.innerText = "Submit";
        let playArea = document.createElement("div");
        playArea.id = "playarea";

        while (board.hasChildNodes()) {
            board.removeChild(board.lastChild);
        }

        board.appendChild(letterQuery);
        board.appendChild(input);
        board.appendChild(submitButton);
        board.appendChild(playArea);

        currentLetter = " ";
        pattern = [];
        guesses = [];
    }
</script>