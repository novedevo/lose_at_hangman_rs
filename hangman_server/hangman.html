<!DOCTYPE html>
<html lang="en-CA">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="author" content="Devon Sawatsky Burnham">

    <title>Lose at Hangman</title>

    <style>
        #playarea {
            display: flex;

        }

        #playarea button {
            font-size: 20px;
            background-color: aliceblue;
            /* color: white; */
            border: 2px solid cornflowerblue;
            border-radius: 8px;
            padding: 2px;
            margin: 2px;
            min-width: 1rem;
        }

        #playarea button:hover {
            background-color: lightblue;
        }

        #playarea button:active {
            background-color: mediumslateblue;
        }
    </style>
</head>

<body>
    <div class="content">
        <h1>Lose at Hangman</h1>
        <noscript>Please enable JavaScript on this page; nothing works without it, and I promise not to be evil :)<br>
            You can view the full script with inspect element, it's all inline.</noscript>
        <main id="gameboard"></main>
        <details>
            <summary>How not to lose at hangman</summary>
            <p>
                When playing against a normal human, the strategy is usually: think of long, complicated words, with rare letters, that your opponent is unlikely to know. 
                This strategy completely fails here (seriously, try it! If it's allowed (scrabble rules), the bot will successfully guess any long word. 
                Yes, you're very clever for picking symphysy, no, that doesn't count. It's obsolete and rare). 
                The bot's been fed a list of 300,000 words, along with data on word usage; you're not going to out-vocabulary it. 
                The real trick is to find holes in its armour: the word prevalence data is necessarily incomplete, and some very common English words are missing (notably, lots of plural nouns and verb conjugations). 
                If you can find a pattern with a bunch of common letters and one or two rarer ones, <em>with other words in the same pattern using more common letters</em>, it gets stuck.
                It only has 6 incorrect guesses, and it's going to guess the common letters first. 
                An example of this is the word "PATS", which is a real word and valid by scrabble rules, and isn't even that uncommon, but there's no data on its prevalence. 
                As such, the bot quickly determines the *ATS pattern, then struggles to find the first letter. It tries oats, bats, cats, etc, but eventually takes more then 6x the allotted guesses. 
                Extremely short words also cause it damage, e.g. ax.
                Unfortunately for my ego, it fails at "the hardest word to guess in hangman", which, according to wikipedia, is jazz.
            </p>
            
        </details>
    </div>
</body>

</html>

<script defer>
    let currentLetter = " ";
    let pattern = [];
    let guesses = [];
    reset();

    function updateValue() {
        const element = document.getElementById("playarea");
        const numLettersInput = document.querySelector('input');
        pattern = [];

        while (element.hasChildNodes()) {
            element.removeChild(element.lastChild);
        }

        if (isNaN(numLettersInput.valueAsNumber) || numLettersInput.valueAsNumber < 1) {
            let p = document.createElement("p");
            p.innerText = "please only submit positive numbers. my code is fragile and so am i";
            element.appendChild(p);
            return;
        }

        for (let i = 0; i < numLettersInput.valueAsNumber; i++) {
            let button = document.createElement("button");
            button.id = "letterbox" + i;
            button.innerText = " ";
            button.setAttribute("onclick", "setButton(" + i + ")");
            // button.onclick = "setButton(" + i + ")";
            element.appendChild(button);
            pattern.push(".");
        }

        let main = document.getElementById("gameboard");
        main.removeChild(document.getElementById("letterQuery"));
        main.removeChild(document.getElementById("num_letters"));
        main.removeChild(document.getElementById("submit"));

        let guessContainer = document.createElement("p");
        let currentGuess = document.createElement("span");
        currentGuess.id = "lastGuess";
        currentGuess.innerText = "No guesses yet";
        let guessTracker = document.createElement("span");
        guessTracker.id = "guessTracker";
        // guessTracker.innerText = "No guesses yet";
        guessContainer.appendChild(currentGuess);
        guessContainer.appendChild(guessTracker);

        let guessButton = document.createElement("button");
        guessButton.type = "button";
        guessButton.id = "guessButton";
        guessButton.setAttribute("onclick", "getNewGuess()");
        guessButton.innerText = "Give me a guess!";
        let resetButton = document.createElement("button");
        resetButton.type = "button";
        resetButton.id = "resetButton";
        resetButton.setAttribute("onclick", "reset()");
        resetButton.innerText = "Reset to defaults";

        main.appendChild(guessContainer);
        main.appendChild(guessButton);
        main.appendChild(resetButton);

        console.log("buttons created");
    }
    function setButton(i) {
        const button = document.getElementById("letterbox" + i);
        if (button.innerText === " ") {
            button.innerText = currentLetter;
            if (currentLetter !== " ") {
                pattern[i] = currentLetter;
            }
        } else if (button.innerText === currentLetter) {
            button.innerText = " ";
            pattern[i] = ".";
        }
    }
    function getNewGuess() {
        let guessContainer = document.getElementById("lastGuess");
        console.log(pattern);
        let innerText = ", past guesses: " + guesses.join(", ") + ". The server has " +
            (6 - guesses.filter((guess) => pattern.indexOf(guess) < 0).length) + " guesses remaining";
        document.getElementById("guessTracker").innerText = innerText;
        let requestString = "api?pattern=" + pattern.join("");
        if (guesses.length > 0) {
            requestString += "&guesses=" + guesses.join("");
        }
        fetch(requestString)
            .then((response) => response.text())
            .then((text) => {
                if (text.length === 1) {
                    currentLetter = text;
                    guesses.push(currentLetter);
                    console.log(currentLetter);
                    guessContainer.innerText = "Server guessed: " + currentLetter;
                } else {
                    guessContainer.innerText = text;
                    document.getElementById("guessButton").remove();
                    currentLetter = " ";
                }
            }
            );
    }
    function reset() {
        let board = document.getElementById("gameboard");

        let letterQuery = document.createElement("label");
        letterQuery.id = "letterQuery";
        letterQuery.innerText = "How many letters is your word?";
        let input = document.createElement("input");
        input.type = "number";
        input.id = "num_letters";
        let submitButton = document.createElement("button");
        submitButton.type = "button";
        submitButton.id = "submit";
        submitButton.setAttribute("onclick", "updateValue()");
        submitButton.innerText = "Submit";
        let playArea = document.createElement("div");
        playArea.id = "playarea";

        while (board.hasChildNodes()) {
            board.removeChild(board.lastChild);
        }

        board.appendChild(letterQuery);
        board.appendChild(input);
        board.appendChild(submitButton);
        board.appendChild(playArea);

        currentLetter = " ";
        pattern = [];
        guesses = [];
    }
</script>